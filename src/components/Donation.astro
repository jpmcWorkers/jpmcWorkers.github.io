---
import Button from './Button.astro';


type Preset = {
  label: string;
  href: string;
  ariaLabel?: string;
};

interface Props {
  publishableKey?: string;  // Why: required by Stripe Buy Button
  buyButtonId?: string;     // Why: identifies the Payment Link with custom amount
  presetsOneTime?: Preset[];
  presetsMonthly?: Preset[];
  title?: string;
  subtitle?: string;
  notes?: string;
}

const {
  publishableKey = 'ENV VARIABLE', // No default, required
  buyButtonId = 'donate-button', // Default ID if not provided
  presetsOneTime = [],
  presetsMonthly = [],
  title = 'Support Us with a Donation',
  subtitle = 'Pick a preset or enter a custom amount. 100% processed by Stripe.',
  notes = 'Payments handled by Stripe. We never see or store your card details.'
} = Astro.props;

const hasPresets = presetsOneTime.length > 0 || presetsMonthly.length > 0;

if (!publishableKey || !buyButtonId) {
  console.warn('Donate.astro: Missing publishableKey or buyButtonId');
}
---

<section class="w-full">
  <!-- Stripe Buy Button loader (safe to include multiple times) -->
  <script async src="https://js.stripe.com/v3/buy-button.js"></script>

  <header class="mb-6 text-center">
    <h2 class="text-3xl font-semibold tracking-tight">{title}</h2>
    {subtitle && <p class="mt-2 text-gray-600">{subtitle}</p>}
  </header>

  <div class="mx-auto max-w-2xl rounded-2xl bg-white p-6 shadow ring-1 ring-gray-200">
    {hasPresets && (
      <div class="space-y-6">
        {presetsOneTime.length > 0 && (
          <div>
            <h3 class="text-sm font-medium text-gray-700">One-time</h3>
            <div class="mt-3 grid grid-cols-2 gap-2 sm:grid-cols-4" role="list">
              {presetsOneTime.map((p) => (
                <Button
                  href={p.href}
                  style="secondary"
                  color="gray"
                  aria-label={p.ariaLabel ?? p.label}
                >
                  {p.label}
                </Button>
              ))}
            </div>
            <p class="mt-2 text-xs text-gray-500">Opens Stripe Checkout in a new tab.</p>
          </div>
        )}

        {presetsMonthly.length > 0 && (
          <div>
            <h3 class="text-sm font-medium text-gray-700">Monthly</h3>
            <div class="mt-3 grid grid-cols-2 gap-2 sm:grid-cols-4" role="list">
              {presetsMonthly.map((p) => (
                <a
                  class='fabulous'
                  href={p.href}
                  style={'fabulous'}
                  aria-label={p.ariaLabel ?? p.label}
                >
                  {p.label}
                </a>
              ))}
            </div>
          </div>
        )}

        <div class="h-px w-full bg-gray-200"></div>
      </div>
    )}

    <div>
      <h3 class="text-sm font-medium text-gray-700">Enter any amount</h3>
      <p class="mt-1 text-xs text-gray-500">Configured in Stripe Payment Links with “Let customers enter an amount”.</p>

      <div class="mt-4 rounded-xl border border-dashed border-gray-300 p-4">
        <stripe-buy-button
          buy-button-id={buyButtonId}
          publishable-key={publishableKey}
          class="w-full"
        >
        </stripe-buy-button>
      </div>
    </div>

    {notes && <p class="mt-6 text-xs text-gray-500">{notes}</p>}
  </div>

  <style>
    /* Why: ensure visible keyboard focus across the page */
    :focus-visible { outline: 3px solid #111827; outline-offset: 2px; }
  </style>
</section>
