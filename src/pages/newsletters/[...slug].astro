---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

// Generate static paths for all newsletters
export async function getStaticPaths() {
  const newsletters = await getCollection('newsletters');
  return newsletters.map((newsletter) => ({
    params: { slug: newsletter.id },
    props: { newsletter },
  }));
}

// Get the newsletter data
const { newsletter } = Astro.props;
const { Content } = await render(newsletter);

// Format date for display
function formatDate(date: Date | string): string {
  const dateObj = typeof date === 'string' ? new Date(date) : date;
  return new Intl.DateTimeFormat('en-US', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric',
    timeZone: 'UTC',
  }).format(dateObj);
}
---

<Layout title={newsletter.data.title}>
  <div class="max-w-4xl mx-auto">
    <!-- Newsletter Header -->
    <div class="mb-8">
      <div class="mb-4">
        <a href="/newsletters" class="text-jpmc-blue hover:text-jpmc-red transition-colors">
          ← Back to Newsletters
        </a>
      </div>
      
      <h1 class="text-3xl font-bold text-jpmc-dark mb-4">{newsletter.data.title}</h1>
      
      <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-6">
        <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full">
          Newsletter
        </span>
        <span class="text-gray-500">
          {formatDate(newsletter.data.date)}
        </span>
        {newsletter.data.featured && (
          <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full">
            Featured
          </span>
        )}
        {newsletter.data.author && (
          <span class="text-gray-600">
            By {newsletter.data.author}
          </span>
        )}
      </div>

      {newsletter.data.description && (
        <p class="text-lg text-gray-600 mb-6">
          {newsletter.data.description}
        </p>
      )}
    </div>

    <!-- Newsletter Content -->
    <div class="bg-white p-8 rounded-lg shadow-md">
      <div class="prose prose-lg max-w-none">
        <Content />
      </div>
    </div>

    <!-- Navigation -->
    <div class="mt-8 flex justify-between">
      <a href="/newsletters" class="text-jpmc-blue hover:text-jpmc-red transition-colors">
        ← All Newsletters
      </a>
      <a href="/news" class="text-jpmc-blue hover:text-jpmc-red transition-colors">
        News & Announcements →
      </a>
    </div>
  </div>
</Layout>
